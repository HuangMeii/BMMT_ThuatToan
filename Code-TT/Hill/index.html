<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hill Cipher - Lý Thuyết và Ứng Dụng</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
            color: #333;
            line-height: 1.6;
        }
        h1, h2, h3 {
            color: #2c3e50;
            margin-top: 0;
        }
        .container {
            background-color: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 15px rgba(0,0,0,0.1);
        }
        .theory-section {
            background-color: #f9f9f9;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 30px;
            border-left: 4px solid #3498db;
        }
        .definition {
            background-color: #e8f4fc;
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
        }
        .example {
            background-color: #fef9e7;
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
            border-left: 4px solid #f39c12;
        }
        .input-group {
            margin-bottom: 20px;
        }
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
        }
        input[type="text"], textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
            box-sizing: border-box;
        }
        textarea {
            min-height: 100px;
            resize: vertical;
        }
        button {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 12px 18px;
            margin-right: 10px;
            margin-bottom: 10px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s;
        }
        button:hover {
            background-color: #2980b9;
            transform: translateY(-2px);
        }
        .button-group {
            margin: 25px 0;
            display: flex;
            flex-wrap: wrap;
        }
        .result {
            margin-top: 25px;
            padding: 20px;
            background-color: #e8f4fc;
            border-radius: 4px;
        }
        .matrix {
            margin: 15px 0;
            font-family: monospace;
            white-space: pre;
            background-color: #f0f0f0;
            padding: 10px;
            border-radius: 4px;
            overflow-x: auto;
        }
        .instructions {
            background-color: #f9f9f9;
            padding: 20px;
            border-radius: 4px;
            margin-top: 30px;
            border-left: 4px solid #3498db;
        }
        .error {
            color: #e74c3c;
            font-weight: bold;
            background-color: #fdecea;
            padding: 10px;
            border-radius: 4px;
        }
        .success {
            color: #27ae60;
            font-weight: bold;
            background-color: #e8f8f0;
            padding: 10px;
            border-radius: 4px;
        }
        .math {
            font-family: "Times New Roman", serif;
            font-style: italic;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 10px;
            text-align: center;
        }
        th {
            background-color: #3498db;
            color: white;
        }
        .tabs {
            display: flex;
            margin-bottom: 20px;
        }
        .tab {
            padding: 10px 20px;
            cursor: pointer;
            background-color: #eee;
            border-radius: 5px 5px 0 0;
            margin-right: 5px;
        }
        .tab.active {
            background-color: #3498db;
            color: white;
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        .process-steps {
            margin-top: 20px;
        }
        .process-step {
            margin-bottom: 15px;
            padding: 10px;
            background-color: #f9f9f9;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Hill Cipher - Mật mã Ma trận</h1>
        <p>Một hệ mã hóa cổ điển sử dụng đại số tuyến tính trong mật mã học</p>
        
        <div class="tabs">
            <div class="tab active" onclick="switchTab('theory')">Lý Thuyết</div>
            <div class="tab" onclick="switchTab('practice')">Thực Hành</div>
        </div>
        
        <div id="theory" class="tab-content active">
            <div class="theory-section">
                <h2>1. Giới thiệu về Hill Cipher</h2>
                <p>Hill Cipher là một hệ mật mã thay thế đa biểu (polygraphic substitution cipher) được phát minh bởi Lester S. Hill năm 1929. Đây là một trong những hệ mật mã đầu tiên sử dụng đại số tuyến tính (ma trận) trong mã hóa.</p>
                
                <div class="definition">
                    <h3>Định nghĩa Hill Cipher</h3>
                    <p>Hill Cipher là hệ mật mã khóa đối xứng sử dụng ma trận khóa vuông <span class="math">K</span> để mã hóa và ma trận nghịch đảo <span class="math">K⁻¹</span> để giải mã. Mỗi ký tự được ánh xạ thành số (A=0, B=1,..., Z=25), và các ký tự được xử lý theo từng khối (block) có độ dài bằng kích thước ma trận khóa.</p>
                </div>
                
                <h2>2. Nguyên lý hoạt động</h2>
                <h3>Mã hóa</h3>
                <p>Cho ma trận khóa <span class="math">K</span> kích thước <span class="math">n×n</span> và vector văn bản rõ <span class="math">P</span> (gồm <span class="math">n</span> ký tự):</p>
                <p class="math">C = K × P mod 26</p>
                <p>Trong đó <span class="math">C</span> là vector bản mã kết quả.</p>
                
                <h3>Giải mã</h3>
                <p>Sử dụng ma trận nghịch đảo <span class="math">K⁻¹</span> (modulo 26):</p>
                <p class="math">P = K⁻¹ × C mod 26</p>
                
                <div class="definition">
                    <h3>Điều kiện ma trận khóa</h3>
                    <p>Ma trận khóa <span class="math">K</span> phải thỏa mãn:</p>
                    <ol>
                        <li>Là ma trận vuông</li>
                        <li>Có định thức <span class="math">det(K) ≠ 0</span></li>
                        <li><span class="math">gcd(det(K), 26) = 1</span> (định thức và 26 nguyên tố cùng nhau)</li>
                    </ol>
                </div>
                
                <div class="example">
                    <h3>Ví dụ minh họa</h3>
                    <p>Cho ma trận khóa 2×2:</p>
                    <p class="math">K = [ 3 3 ]
        [ 2 5 ]</p>
                    <p>Văn bản rõ: "HELP" → "HE LP"</p>
                    <p>Mã hóa "HE" (H=7, E=4):</p>
                    <p class="math">[ 3 3 ] [ 7 ] = [ 3×7 + 3×4 ] = [ 33 mod 26 ] = [ 7 ] → "H"
        [ 2 5 ] [ 4 ]   [ 2×7 + 5×4 ]   [ 34 mod 26 ]   [ 8 ] → "I"</p>
                    <p>Kết quả: "HE" → "HI"</p>
                </div>
                
                <h2>3. Ưu điểm và Nhược điểm</h2>
                <table>
                    <tr>
                        <th>Ưu điểm</th>
                        <th>Nhược điểm</th>
                    </tr>
                    <tr>
                        <td>
                            <ul>
                                <li>Mạnh hơn các mật mã thay thế đơn giản</li>
                                <li>Khó bị phá bằng phương pháp phân tích tần suất</li>
                                <li>Có thể thay đổi khóa dễ dàng bằng cách thay ma trận</li>
                            </ul>
                        </td>
                        <td>
                            <ul>
                                <li>Dễ bị tấn công nếu biết một cặp bản rõ/bản mã đủ dài</li>
                                <li>Yêu cầu ma trận khả nghịch modulo 26</li>
                                <li>Không tự động xử lý các ký tự không phải chữ cái</li>
                            </ul>
                        </td>
                    </tr>
                </table>
            </div>
        </div>
        
        <div id="practice" class="tab-content">
            <h2>Công Cụ Mã Hóa/Giải Mã Hill Cipher</h2>
            
            <div class="input-group">
                <label for="key">Khóa (nhập chữ cái cho ma trận 2x2, ví dụ "HILL"):</label>
                <input type="text" id="key" placeholder="Nhập khóa (không quá 10 chữ cái)" maxlength="4">
            </div>
            
            <div class="input-group">
                <label for="plaintext">Văn bản cần mã hóa (chỉ chữ cái):</label>
                <textarea id="plaintext" placeholder="Nhập văn bản cần mã hóa"></textarea>
            </div>
            
            <div class="button-group">
                <button onclick="encrypt()">Mã hóa</button>
                <button onclick="decrypt()">Giải mã</button>
                <button onclick="generateRandomKey()">Tạo khóa ngẫu nhiên</button>
                <button onclick="clearAll()">Xóa tất cả</button>
                <button onclick="showExample()">Ví dụ mẫu</button>
            </div>
            
            <div class="result">
                <h3>Kết quả:</h3>
                <div id="matrixInfo"></div>
                <label for="ciphertext">Bản mã:</label>
                <textarea id="ciphertext" readonly></textarea>
                <label for="decryptedText">Bản giải mã:</label>
                <textarea id="decryptedText" readonly></textarea>
                <div id="processSteps" class="process-steps"></div>
                <div id="status"></div>
            </div>
            
            <div class="instructions">
                <h3>Hướng dẫn sử dụng:</h3>
                <ol>
                    <li>Nhập khóa gồm 4 chữ cái (tự động chuyển thành ma trận 2x2)</li>
                    <li>Nhập văn bản cần mã hóa (tự động loại bỏ ký tự không phải chữ cái)</li>
                    <li>Nhấn "Mã hóa" hoặc "Giải mã"</li>
                    <li>Nhấn "Tạo khóa ngẫu nhiên" để hệ thống tạo một khóa hợp lệ</li>
                    <li>Nhấn "Ví dụ mẫu" để xem ví dụ minh họa</li>
                </ol>
                <p><strong>Lưu ý:</strong> 
                <ul>
                    <li>Khóa phải tạo ra ma trận khả nghịch modulo 26 (định thức phải nguyên tố cùng nhau với 26)</li>
                    <li>Nếu văn bản cần mã hóa có độ dài lẻ, hệ thống sẽ tự động thêm ký tự cuối cùng để đệm</li>
                </ul>
                </p>
            </div>
        </div>
    </div>

    <script>
        // Chuyển đổi giữa các tab
        function switchTab(tabName) {
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            document.querySelector(`.tab[onclick="switchTab('${tabName}')"]`).classList.add('active');
            document.getElementById(tabName).classList.add('active');
        }
        
        // Phép chia dư trong modulo 26
        function phepChiaDu(n, m) {
            return ((n % m) + m) % m;
        }

        // Chuyển ký tự sang số (A=0, B=1,..., Z=25)
        function chuSangSo(chu) {
            return chu.toUpperCase().charCodeAt(0) - 'A'.charCodeAt(0);
        }

        // Chuyển số sang ký tự
        function soSangChu(so) {
            return String.fromCharCode(phepChiaDu(so, 26) + 'A'.charCodeAt(0));
        }

        // Tìm nghịch đảo nhân trong modulo 26
        function timNghichDaoNhan(dinhThuc) {
            dinhThuc = phepChiaDu(dinhThuc, 26);
            for(let i = 0; i < 26; i++) {
                if(phepChiaDu(dinhThuc * i, 26) === 1) {
                    return i;
                }
            }
            return -1;
        }

        // Tạo ma trận từ khóa (4 chữ cái)
        function taoMaTranTuKhoa() {
            const chuoiKhoa = document.getElementById('key').value.toUpperCase().replace(/[^A-Z]/g, '');
            if(chuoiKhoa.length % 2 !== 0 || chuoiKhoa.length === 0 || chuoiKhoa.length > 10) {
                throw new Error("Khóa phải có độ dài là số chẵn và không quá 10 ký tự");
            }
            
            const kichThuoc = chuoiKhoa.length / 2;
            const maTran = Array(kichThuoc).fill().map(() => Array(kichThuoc).fill(0));
            
            // Chuyển chuỗi khóa thành ma trận
            let idx = 0;
            for(let i = 0; i < kichThuoc; i++) {
                for(let j = 0; j < kichThuoc; j++) {
                    maTran[i][j] = chuSangSo(chuoiKhoa[idx++]);
                }
            }

            // Tính định thức của ma trận
            let dinhThuc;
            if(kichThuoc === 2) {
                dinhThuc = phepChiaDu(maTran[0][0] * maTran[1][1] - maTran[0][1] * maTran[1][0], 26);
            } else {
                throw new Error("Hiện tại chỉ hỗ trợ ma trận 2x2");
            }

            const nghichDao = timNghichDaoNhan(dinhThuc);
            if(nghichDao === -1) {
                throw new Error("Ma trận khóa không khả nghịch mod 26");
            }

            return maTran;
        }

        // Tạo ma trận từ chuỗi văn bản
        function taoMaTranTuChuoi(chuoi) {
            const cacSo = Array.from(chuoi).map(c => chuSangSo(c));
            const maTran = [[], []];
            for(let i = 0; i < cacSo.length; i += 2) {
                maTran[0].push(cacSo[i]);
                maTran[1].push(cacSo[i + 1]);
            }
            return maTran;
        }

        // Mã hóa văn bản
        function encrypt() {
            try {
                const banRoGoc = document.getElementById('plaintext').value.toUpperCase().replace(/[^A-Z]/g, '');
                if (!banRoGoc) {
                    throw new Error("Vui lòng nhập văn bản cần mã hóa");
                }
                
                let banRo = banRoGoc;
                if(banRo.length % 2 !== 0) {
                    banRo += banRo[banRo.length - 1];
                }

                const khoa = taoMaTranTuKhoa();
                const maTranBanRo = taoMaTranTuChuoi(banRo);
                let ketQua = '';
                
                // Hiển thị thông tin ma trận khóa
                const chuoiKhoa = document.getElementById('key').value.toUpperCase();
                const dinhThuc = phepChiaDu(khoa[0][0] * khoa[1][1] - khoa[0][1] * khoa[1][0], 26);
                const nghichDao = timNghichDaoNhan(dinhThuc);
                
                let processHTML = `
                    <div class="process-step">
                        <h4>1. Thông tin ma trận khóa:</h4>
                        <div class="matrix">K = [${chuoiKhoa[0]}(${khoa[0][0]}) ${chuoiKhoa[1]}(${khoa[0][1]})]
    [${chuoiKhoa[2]}(${khoa[1][0]}) ${chuoiKhoa[3]}(${khoa[1][1]})]</div>
                        <p>Định thức = ${dinhThuc}</p>
                        <p>Nghịch đảo định thức mod 26 = ${nghichDao}</p>
                    </div>
                    
                    <div class="process-step">
                        <h4>2. Chi tiết mã hóa:</h4>
                        <p>Bản rõ gốc: ${banRoGoc}</p>
                        ${banRoGoc.length % 2 !== 0 ? `<p>Bản rõ sau khi thêm đệm: ${banRo} (thêm ký tự '${banRo[banRo.length - 1]}' ở cuối)</p>` : ''}
                `;

                // Chi tiết mã hóa từng cặp
                for(let i = 0; i < banRo.length/2; i++) {
                    const cap = banRo.substr(i*2, 2);
                    const hang0 = phepChiaDu(maTranBanRo[0][i] * khoa[0][0] + maTranBanRo[1][i] * khoa[0][1], 26);
                    const hang1 = phepChiaDu(maTranBanRo[0][i] * khoa[1][0] + maTranBanRo[1][i] * khoa[1][1], 26);
                    const capMaHoa = soSangChu(hang0) + soSangChu(hang1);
                    
                    processHTML += `
                        <div class="process-step">
                            <p>Cặp "${cap}": (${maTranBanRo[0][i]},${maTranBanRo[1][i]}) → ${capMaHoa}</p>
                            <div class="matrix">C = [${khoa[0][0]} ${khoa[0][1]}] × [${maTranBanRo[0][i]}] = [${hang0}] → ${soSangChu(hang0)}
    [${khoa[1][0]} ${khoa[1][1]}]   [${maTranBanRo[1][i]}]   [${hang1}] → ${soSangChu(hang1)}</div>
                        </div>
                    `;
                    ketQua += capMaHoa;
                }

                // Kết quả cuối cùng
                processHTML += `
                    <div class="process-step">
                        <h4>3. Kết quả bản mã:</h4>
                        <p>${ketQua}</p>
                    </div>
                `;

                document.getElementById('ciphertext').value = ketQua;
                document.getElementById('processSteps').innerHTML = processHTML;
                document.getElementById('status').innerHTML = 
                    `<div class="success">Mã hóa thành công! Đã xử lý ${banRo.length/2} cặp ký tự.</div>`;
                
            } catch(error) {
                document.getElementById('status').innerHTML = 
                    `<div class="error">Lỗi: ${error.message}</div>`;
            }
        }

        // Giải mã văn bản
        function decrypt() {
            try {
                const banMa = document.getElementById('ciphertext').value.toUpperCase().replace(/[^A-Z]/g, '');
                if (!banMa) {
                    throw new Error("Vui lòng nhập bản mã cần giải mã");
                }
                if(banMa.length % 2 !== 0) {
                    throw new Error("Độ dài bản mã phải chẵn");
                }

                const khoa = taoMaTranTuKhoa();
                const dinhThuc = phepChiaDu(khoa[0][0] * khoa[1][1] - khoa[0][1] * khoa[1][0], 26);
                const nghichDaoDinhThuc = timNghichDaoNhan(dinhThuc);
                
                const khoaNghichDao = [
                    [phepChiaDu(khoa[1][1] * nghichDaoDinhThuc, 26), phepChiaDu(-khoa[0][1] * nghichDaoDinhThuc, 26)],
                    [phepChiaDu(-khoa[1][0] * nghichDaoDinhThuc, 26), phepChiaDu(khoa[0][0] * nghichDaoDinhThuc, 26)]
                ];

                const maTranBanMa = taoMaTranTuChuoi(banMa);
                let ketQua = '';
                
                let processHTML = `
                    <div class="process-step">
                        <h4>1. Thông tin ma trận khóa và ma trận nghịch đảo:</h4>
                        <div class="matrix">K = [${document.getElementById('key').value[0]}(${khoa[0][0]}) ${document.getElementById('key').value[1]}(${khoa[0][1]})]
    [${document.getElementById('key').value[2]}(${khoa[1][0]}) ${document.getElementById('key').value[3]}(${khoa[1][1]})]</div>
                        <p>Định thức = ${dinhThuc}</p>
                        <p>Nghịch đảo định thức mod 26 = ${nghichDaoDinhThuc}</p>
                        <div class="matrix">K^(-1) = [${khoaNghichDao[0][0]} ${khoaNghichDao[0][1]}]
         [${khoaNghichDao[1][0]} ${khoaNghichDao[1][1]}]</div>
                    </div>
                    
                    <div class="process-step">
                        <h4>2. Chi tiết giải mã:</h4>
                        <p>Bản mã: ${banMa}</p>
                `;

                // Chi tiết giải mã từng cặp
                for(let i = 0; i < banMa.length/2; i++) {
                    const cap = banMa.substr(i*2, 2);
                    const hang0 = phepChiaDu(maTranBanMa[0][i] * khoaNghichDao[0][0] + maTranBanMa[1][i] * khoaNghichDao[0][1], 26);
                    const hang1 = phepChiaDu(maTranBanMa[0][i] * khoaNghichDao[1][0] + maTranBanMa[1][i] * khoaNghichDao[1][1], 26);
                    const capGiaiMa = soSangChu(hang0) + soSangChu(hang1);
                    
                    processHTML += `
                        <div class="process-step">
                            <p>Cặp "${cap}": (${maTranBanMa[0][i]},${maTranBanMa[1][i]}) → ${capGiaiMa}</p>
                            <div class="matrix">P = [${khoaNghichDao[0][0]} ${khoaNghichDao[0][1]}] × [${maTranBanMa[0][i]}] = [${hang0}] → ${soSangChu(hang0)}
    [${khoaNghichDao[1][0]} ${khoaNghichDao[1][1]}]   [${maTranBanMa[1][i]}]   [${hang1}] → ${soSangChu(hang1)}</div>
                        </div>
                    `;
                    ketQua += capGiaiMa;
                }

                // Kết quả cuối cùng
                processHTML += `
                    <div class="process-step">
                        <h4>3. Kết quả bản rõ:</h4>
                        <p>${ketQua}</p>
                    </div>
                `;

                document.getElementById('decryptedText').value = ketQua;
                document.getElementById('processSteps').innerHTML = processHTML;
                document.getElementById('status').innerHTML = 
                    `<div class="success">Giải mã thành công! Đã xử lý ${banMa.length/2} cặp ký tự.</div>`;
                
            } catch(error) {
                document.getElementById('status').innerHTML = 
                    `<div class="error">Lỗi: ${error.message}</div>`;
            }
        }

        // Tạo khóa ngẫu nhiên
        function generateRandomKey() {
            let khoa;
            let maTran;
            let dinhThuc;
            let nghichDao;
            
            do {
                khoa = '';
                for (let i = 0; i < 4; i++) {
                    khoa += String.fromCharCode(Math.floor(Math.random() * 26) + 'A'.charCodeAt(0));
                }
                
                maTran = [
                    [chuSangSo(khoa[0]), chuSangSo(khoa[1])],
                    [chuSangSo(khoa[2]), chuSangSo(khoa[3])]
                ];
                
                dinhThuc = phepChiaDu(maTran[0][0] * maTran[1][1] - maTran[0][1] * maTran[1][0], 26);
                nghichDao = timNghichDaoNhan(dinhThuc);
            } while (nghichDao === -1);
            
            document.getElementById('key').value = khoa;
            document.getElementById('status').innerHTML = 
                `<div class="success">Đã tạo khóa ngẫu nhiên: ${khoa} (Định thức = ${dinhThuc}, Nghịch đảo = ${nghichDao})</div>`;
        }

        // Xóa tất cả
        function clearAll() {
            document.getElementById('key').value = '';
            document.getElementById('plaintext').value = '';
            document.getElementById('ciphertext').value = '';
            document.getElementById('decryptedText').value = '';
            document.getElementById('processSteps').innerHTML = '';
            document.getElementById('status').innerHTML = '';
        }

        // Hiển thị ví dụ mẫu
        function showExample() {
            document.getElementById('key').value = 'HILL';
            document.getElementById('plaintext').value = 'ATTACK AT DAWN';
            document.getElementById('status').innerHTML = 
                `<div class="success">Đã tải ví dụ mẫu với khóa "HILL" và văn bản "ATTACK AT DAWN". Nhấn "Mã hóa" để xem kết quả.</div>`;
        }
    </script>
</body>
</html>